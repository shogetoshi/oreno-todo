# Issue #0048: カレンダーイベントのMTG URL保持と起動機能

## 概要

カレンダーイベントにMTG URLを保持できるようにし、startボタンを押すとそのURLを開く機能を実装する。

## Issue詳細

- カレンダーイベントの場合、MTGのURLを保持するようにする
  - URL保持のためのフィールドを新しく作る
  - URLはGoogleCalendarから取得したイベント内容から作る
    - 今は仮実装として、取得したイベントを渡して固定文字列を返す関数とすること
- カレンダーイベントのstartボタン（今は何にも使っていないボタン）を押すとそのURLを開くようにする
  - URLがないor空文字の場合は何もしない

## 実装内容

### 1. Model層: CalendarEventにmeetingUrlフィールドを追加

**ファイル: `src/models/CalendarEvent.ts`**

- `CalendarEvent`クラスのコンストラクタに`meetingUrl`フィールドを追加
  - 型: `string | null`
  - 位置: `timeRanges`の前に追加
- `getMeetingUrl()`メソッドを追加
  - `meetingUrl`を返す
- すべての`new CalendarEvent()`呼び出し箇所に`meetingUrl`パラメータを追加
  - `setTaskcode()`, `setText()`, `setCompleted()`, `fromGoogleCalendarEvent()`, `fromJSON()`など
- `fromGoogleCalendarEvent()`メソッドで`extractMeetingUrlFromGoogleEvent()`を呼び出す
  - 新しい静的プライベートメソッド`extractMeetingUrlFromGoogleEvent()`を作成
  - 今は固定文字列`"https://meet.google.com/xxx-xxxx-xxx"`を返す（仮実装）
  - 将来的にはGoogleカレンダーイベントの`description`や`hangoutLink`フィールドからURLを抽出する予定
- `toJSON()`メソッドに`meetingUrl`を追加

### 2. Model層: URL抽出ユーティリティ関数（仮実装）

**ファイル: `src/models/CalendarEvent.ts`**

- `extractMeetingUrlFromGoogleEvent(event)`メソッドを実装
  - 引数: `CalendarEventType`（Googleカレンダーイベント）
  - 戻り値: `string | null`
  - 仮実装: 固定文字列`"https://meet.google.com/xxx-xxxx-xxx"`を返す
  - コメントに「TODO: 実際のイベントデータから抽出する」と記載

### 3. Model層: ListItemインターフェースにgetMeetingUrl()を追加

**ファイル: `src/models/ListItem.ts`**

- `ListItem`インターフェースに`getMeetingUrl(): string | null`メソッドを追加

### 4. Model層: TodoクラスにgetMeetingUrl()を実装

**ファイル: `src/models/Todo.ts`**

- `Todo`クラスに`getMeetingUrl()`メソッドを追加
  - 常に`null`を返す（TodoはMTG URLを持たない）

### 5. Main Process: URL起動機能を実装

**ファイル: `electron/main.ts`**

- IPCハンドラー`open-url`を追加
  - 引数: `url: string`
  - `shell.openExternal(url)`を使用してURLを外部ブラウザで開く
  - セキュリティチェック: URLが`http://`または`https://`で始まることを確認
  - 戻り値: `{ success: boolean, error?: string }`

### 6. Preload Script: openUrl APIを公開

**ファイル: `electron/preload.ts`**

- `contextBridge`で`openUrl`関数を公開
  - `openUrl: (url: string) => ipcRenderer.invoke('open-url', url)`

### 7. 型定義: ElectronAPIにopenUrlを追加

**ファイル: `src/types/electron.d.ts`**

- `ElectronAPI`インターフェースに`openUrl`を追加
  - `openUrl: (url: string) => Promise<{ success: boolean; error?: string }>`

### 8. Controller層: openMeetingUrlメソッドを追加

**ファイル: `src/hooks/useTodos.ts`**

- `openMeetingUrl`関数を追加
  - 引数: `id: string`（アイテムID）
  - 処理フロー:
    1. `todos`配列から該当アイテムを検索
    2. アイテムが見つからない場合はエラーログを出力して終了
    3. `item.getMeetingUrl()`でURLを取得
    4. URLが`null`または空文字の場合は何もしない
    5. `window.electronAPI.openUrl(url)`を呼び出す
    6. エラーハンドリング: 失敗時はコンソールエラーを出力
- `return`文に`openMeetingUrl`を追加

### 9. View層: startボタンクリック時の処理を変更

**ファイル: `src/components/TodoItem.tsx`**

- `TodoItemProps`に`onOpenMeetingUrl: (id: string) => void`を追加
- `handleTimerClick`関数を変更:
  - アイテムタイプが`ListItemType.CALENDAR_EVENT`の場合:
    - `onOpenMeetingUrl(todoId)`を呼び出す
  - アイテムタイプが`ListItemType.TODO`の場合:
    - 既存のタイマー処理を実行（`onStartTimer`/`onStopTimer`）

### 10. View層: TodoItem呼び出し元でonOpenMeetingUrlを渡す

**ファイル: `src/components/DateGroupedTodoList.tsx`または`src/components/TodoList.tsx`**

- `TodoItem`コンポーネントに`onOpenMeetingUrl={openMeetingUrl}`プロップを渡す
- `useTodos`フックから`openMeetingUrl`を取得

## 実装手順

1. **Model層の実装**（ビジネスロジック）
   - `CalendarEvent.ts`にフィールド追加、メソッド追加
   - `ListItem.ts`にインターフェース追加
   - `Todo.ts`にメソッド追加（nullを返す）

2. **IPC通信の実装**（Main Process ↔ Renderer Process）
   - `electron/main.ts`にIPCハンドラー追加
   - `electron/preload.ts`にAPI公開
   - `src/types/electron.d.ts`に型定義追加

3. **Controller層の実装**（状態管理・IPC通信）
   - `useTodos.ts`に`openMeetingUrl`関数追加

4. **View層の実装**（UI表示）
   - `TodoItem.tsx`のstartボタン動作を変更
   - 親コンポーネントで`onOpenMeetingUrl`プロップを渡す

## 考慮事項

### データ互換性

- 既存のJSONデータには`meetingUrl`フィールドが存在しない
- `fromJSON()`で`json.meetingUrl || null`としてデフォルト値を設定する
- 既存データを読み込んでも問題なく動作する

### セキュリティ

- `shell.openExternal()`はセキュリティリスクがあるため、URLスキームをチェック
- `http://`または`https://`のみを許可
- 不正なURLの場合はエラーを返す

### UX

- URLが設定されていないCalendarEventの場合、startボタンは何もしない
- 将来的には、URLがない場合はボタンを無効化するなどのUI改善が考えられる

### テスト観点

- CalendarEventに`meetingUrl`が正しく保存・読み込みされるか
- URLが空の場合、startボタンが何もしないか
- URLが設定されている場合、正しくブラウザが起動するか
- Todoの`getMeetingUrl()`が常に`null`を返すか
- 不正なURLスキーム（例: `file://`）がブロックされるか

## 変更ファイルリスト

1. `src/models/CalendarEvent.ts` - meetingUrlフィールド追加、メソッド追加
2. `src/models/ListItem.ts` - インターフェースにgetMeetingUrl()追加
3. `src/models/Todo.ts` - getMeetingUrl()実装
4. `electron/main.ts` - open-url IPCハンドラー追加
5. `electron/preload.ts` - openUrl API公開
6. `src/types/electron.d.ts` - 型定義追加
7. `src/hooks/useTodos.ts` - openMeetingUrl関数追加
8. `src/components/TodoItem.tsx` - startボタン動作変更
9. 親コンポーネント（`DateGroupedTodoList.tsx`または`TodoList.tsx`） - onOpenMeetingUrlプロップ渡し

## 注意事項

- 仮実装のため、URL抽出ロジックは固定文字列を返す
- 将来的には`event.description`や`event.hangoutLink`などから実際のURLを抽出する必要がある
- startボタンの動作がTodoとCalendarEventで異なるため、UIで視覚的に区別できるとより良い（今回のissueでは対象外）
