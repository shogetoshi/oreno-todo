# 実装計画: 時間の取り扱いの統一

## Issue概要

時間を全て秒で計算するようにリファクタリングする。

### 要件
- 時間を全て秒で計算するようにする
- 表示は秒以外もあるが、その表現は全てViewレイヤーで変換すること
- 実装のリファクタリングであり、現状の機能に変更は及ぼさないこと

## 現状分析

### 現在の時間単位の使用状況

| レイヤー | ファイル | 関数/プロパティ | 現在の単位 |
|---------|---------|---------------|----------|
| Model | `ListItem.ts` | `getTotalExecutionTimeInMinutes()` | 分 |
| Model | `ListItem.ts` | `getExecutionTimeForDate()` | 分 |
| Model | `Todo.ts` | `getTotalExecutionTimeInMinutes()` | 分 |
| Model | `Todo.ts` | `getExecutionTimeForDate()` | 分 |
| Model | `CalendarEvent.ts` | `getTotalExecutionTimeInMinutes()` | 分 |
| Model | `CalendarEvent.ts` | `getExecutionTimeForDate()` | 分 |
| Model | `TimecardRepository.ts` | `calculateWorkingTimeForDate()` | 分 |
| Utility | `taskExecutionTime.ts` | `calculateExecutionTimeForDate()` | 分 |
| Utility | `taskExecutionTime.ts` | `TaskExecutionSegment.minutes` | 分 |
| Utility | `taskExecutionTime.ts` | `StackBarDisplayConfig.totalMinutes` | 分 |
| Utility | `taskExecutionTime.ts` | `StackBarDisplayConfig.displayMaxMinutes` | 分 |
| View | `TodoItem.tsx` | 表示時 | 分をそのまま表示 |
| View | `TaskExecutionStackBar.tsx` | 表示時 | 分→時間変換 |

## 実装内容

### 1. ListItemインターフェースの更新

**ファイル**: `src/models/ListItem.ts`

- `getTotalExecutionTimeInMinutes()` を `getTotalExecutionTimeInSeconds()` にリネーム
- `getExecutionTimeForDate()` のJSDocを「秒単位を返す」に更新

### 2. Todoクラスの更新

**ファイル**: `src/models/Todo.ts`

- `getTotalExecutionTimeInMinutes()` を `getTotalExecutionTimeInSeconds()` にリネーム
  - 内部計算: ミリ秒→秒→分 から ミリ秒→秒 に変更（分への変換を削除）
- `getExecutionTimeForDate()` を秒単位で返すように変更
  - 内部計算: ミリ秒→秒 で返す（分への変換を削除）

### 3. CalendarEventクラスの更新

**ファイル**: `src/models/CalendarEvent.ts`

- `getTotalExecutionTimeInMinutes()` を `getTotalExecutionTimeInSeconds()` にリネーム
  - 内部計算: ミリ秒→秒 で返す（分への変換を削除）
- `getExecutionTimeForDate()` を秒単位で返すように変更
  - 内部計算: ミリ秒→秒 で返す（分への変換を削除）

### 4. taskExecutionTime.tsの更新

**ファイル**: `src/utils/taskExecutionTime.ts`

- `calculateExecutionTimeForDate()` を秒単位で返すように変更
- `TaskExecutionSegment` インターフェース: `minutes` を `seconds` にリネーム
- `StackBarDisplayConfig` インターフェース:
  - `totalMinutes` を `totalSeconds` にリネーム
  - `displayMaxMinutes` を `displayMaxSeconds` にリネーム
- `calculateStackBarDisplay()` 関数内の計算ロジックを秒ベースに更新
  - 基準値: `BASE_MINUTES = 12 * 60` → `BASE_SECONDS = 12 * 60 * 60`

### 5. TimecardRepositoryの更新

**ファイル**: `src/models/TimecardRepository.ts`

- `calculateWorkingTimeForDate()` を秒単位で返すように変更
  - 内部計算: ミリ秒→秒 で返す（分への変換を削除）
  - JSDocコメントを「秒単位で計算する」に更新

### 6. View層での変換処理追加（表示フォーマット）

**ファイル**: `src/components/TodoItem.tsx`

- `getExecutionTimeForDate()` と `getTotalExecutionTimeInSeconds()` の結果を秒→分に変換して表示
- 変換ロジック: `Math.floor(seconds / 60)`

**ファイル**: `src/components/TaskExecutionStackBar.tsx`

- `segments.seconds` を秒→時間に変換して表示
- `displayMaxSeconds` を使用してパーセンテージ計算
- `workingTimeSeconds` を秒→時間に変換して表示
- 変換ロジック: `(seconds / 3600).toFixed(1)` で時間表示

### 7. テストファイルの更新

以下のテストファイルを、秒単位に対応するよう更新する:

- `src/models/Todo.test.ts`
- `src/models/CalendarEvent.test.ts`
- `src/models/TimecardRepository.test.ts`
- `src/utils/taskExecutionTime.test.ts`

## 考慮事項

### 互換性
- JSONデータ構造に変更なし（timeRangesのstart/endは文字列のまま）
- 外部API（HTTP API）のレスポンスに影響なし

### テスト
- 既存テストのアサーション値を分→秒に更新する必要あり
- 変換後も同等の動作をすることを確認

### 表示の一貫性
- 現在の表示形式（分単位、時間単位）は維持される
- 変換ロジックがViewレイヤーに移動するだけ

## リネーム対象まとめ

| 変更前 | 変更後 |
|-------|-------|
| `getTotalExecutionTimeInMinutes()` | `getTotalExecutionTimeInSeconds()` |
| `TaskExecutionSegment.minutes` | `TaskExecutionSegment.seconds` |
| `StackBarDisplayConfig.totalMinutes` | `StackBarDisplayConfig.totalSeconds` |
| `StackBarDisplayConfig.displayMaxMinutes` | `StackBarDisplayConfig.displayMaxSeconds` |
